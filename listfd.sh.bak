#!/bin/bash

# This script is going to list the names of directories and files separately, 
# and display the total number of directories and files.

#Zhicheng Pan, 104639463

#defining a function to list directories and files and count their number separately
function listdir() 
{
    local cur_dir  workdir
          workdir=$1      

    cd ${workdir}
    #obtain the current directory
    cur_dir=$(pwd)
    

    #handling the file name with space
    IFS=$(echo -en "\n\b")
    echo -en $IFS

    #using recursion to list directories and files
    for dirlist in $(ls ${cur_dir})
    do
        if test -d ${dirlist}
        #If it is also a directory, print and count it, then recurse function itself 
        #to list it again.
        then

            echo ${dirlist}
            dCount=${dCount}+1
            cd ${dirlist}
            listdir ${cur_dir}/${dirlist}
            cd ..

        #If it is a file, print and count it, move to the next loop. It plays 
        #an important role for exiting the recursion.
        else                         

            echo ${cur_dir}/${dirlist}
            fCount=${fCount}+1
        fi
    #Once for loop completed, one or more recursion completed. Repeat it until
    #all the recursions completed.    
    done

}



#The script starts from here:

    #defining variables to count the number of directories and files
    declare -i dCount=0
	declare -i fCount=0

if [[ $# -ne 1 ]]; then
        echo "Please refer to the usage:"
        echo "usage: ./listfd.sh <directory_name>"
        exit 1

#if end user's input is not a directory, tips will be shown to them.
elif test -f $1
then
    echo "You input a file name but not a directory, pls reinput and try again!"
    exit 1
#String comparing
 elif [[ $1 == "/" ]]
 then
     echo "Listing the / directory takes too much time, pls input another directory"
     exit 1

#if end user's input is a directory, the listing process will start
elif test -d $1
then
    #invoking the function listdir to list names of directories and files
    listdir $1

    #printing out the caculating result
    echo "-----------------------------------------------------------------------"
    echo "The total number of directories is: " ${dCount}
    echo "The total number of files is: " ${fCount}

else
    echo "The directory doesn't exist, pls input a new one!"
    exit 1
fi




